"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.BareIssueishListController = void 0;

var _react = _interopRequireDefault(require("react"));

var _propTypes = _interopRequireDefault(require("prop-types"));

var _reactRelay = require("react-relay");

var _propTypes2 = require("../prop-types");

var _issueishListView = _interopRequireDefault(require("../views/issueish-list-view"));

var _issueish = _interopRequireDefault(require("../models/issueish"));

var _electron = require("electron");

var _reporterProxy = require("../reporter-proxy");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

const {
  Menu,
  MenuItem
} = _electron.remote;

const StatePropType = _propTypes.default.oneOf(['EXPECTED', 'PENDING', 'SUCCESS', 'ERROR', 'FAILURE']);

class BareIssueishListController extends _react.default.Component {
  constructor(props) {
    super(props);

    _defineProperty(this, "openOnGitHub", async url => {
      await _electron.shell.openExternal(url);
      (0, _reporterProxy.addEvent)('open-issueish-in-browser', {
        package: 'github',
        component: this.constructor.name
      });
    });

    _defineProperty(this, "showActionsMenu",
    /* istanbul ignore next */
    issueish => {
      const menu = new Menu();
      menu.append(new MenuItem({
        label: 'See reviews',
        click: () => this.props.onOpenReviews(issueish)
      }));
      menu.append(new MenuItem({
        label: 'Open on GitHub',
        click: () => this.openOnGitHub(issueish.getGitHubURL())
      }));
      menu.popup(_electron.remote.getCurrentWindow());
    });

    this.state = {};
  }

  static getDerivedStateFromProps(props, state) {
    if (props.results === null) {
      return {
        lastResults: null,
        issueishes: []
      };
    }

    if (props.results !== state.lastResults) {
      return {
        lastResults: props.results,
        issueishes: props.results.map(node => new _issueish.default(node)).filter(props.resultFilter)
      };
    }

    return null;
  }

  render() {
    return /*#__PURE__*/_react.default.createElement(_issueishListView.default, {
      title: this.props.title,
      isLoading: this.props.isLoading,
      total: this.props.total,
      issueishes: this.state.issueishes,
      error: this.props.error,
      needReviewsButton: this.props.needReviewsButton,
      onIssueishClick: this.props.onOpenIssueish,
      onMoreClick: this.props.onOpenMore,
      openReviews: this.props.onOpenReviews,
      openOnGitHub: this.openOnGitHub,
      showActionsMenu: this.showActionsMenu,
      emptyComponent: this.props.emptyComponent
    });
  }

}

exports.BareIssueishListController = BareIssueishListController;

_defineProperty(BareIssueishListController, "propTypes", {
  results: _propTypes.default.arrayOf(_propTypes.default.shape({
    number: _propTypes.default.number.isRequired,
    title: _propTypes.default.string.isRequired,
    url: _propTypes.default.string.isRequired,
    author: _propTypes.default.shape({
      login: _propTypes.default.string.isRequired,
      avatarUrl: _propTypes.default.string.isRequired
    }),
    createdAt: _propTypes.default.string.isRequired,
    headRefName: _propTypes.default.string.isRequired,
    repository: _propTypes.default.shape({
      id: _propTypes.default.string.isRequired,
      name: _propTypes.default.string.isRequired,
      owner: _propTypes.default.shape({
        login: _propTypes.default.string.isRequired
      }).isRequired
    }).isRequired,
    commits: _propTypes.default.shape({
      nodes: _propTypes.default.arrayOf(_propTypes.default.shape({
        commit: _propTypes.default.shape({
          status: _propTypes.default.shape({
            contexts: _propTypes.default.arrayOf(_propTypes.default.shape({
              state: StatePropType.isRequired
            }).isRequired).isRequired
          })
        })
      }))
    })
  })),
  total: _propTypes.default.number.isRequired,
  isLoading: _propTypes.default.bool.isRequired,
  title: _propTypes.default.string.isRequired,
  error: _propTypes.default.object,
  resultFilter: _propTypes.default.func,
  onOpenIssueish: _propTypes.default.func.isRequired,
  onOpenReviews: _propTypes.default.func.isRequired,
  onOpenMore: _propTypes.default.func,
  emptyComponent: _propTypes.default.func,
  endpoint: _propTypes2.EndpointPropType,
  needReviewsButton: _propTypes.default.bool
});

_defineProperty(BareIssueishListController, "defaultProps", {
  results: [],
  total: 0,
  resultFilter: () => true
});

var _default = (0, _reactRelay.createFragmentContainer)(BareIssueishListController, {
  results: function () {
    const node = require("./__generated__/issueishListController_results.graphql");

    if (node.hash && node.hash !== "af31b5400d8cce5026fc1bb3fc42dc91") {
      console.error("The definition of 'issueishListController_results' appears to have changed. Run `relay-compiler` to update the generated files to receive the expected data.");
    }

    return require("./__generated__/issueishListController_results.graphql");
  }
});

exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL2xpYi9jb250cm9sbGVycy9pc3N1ZWlzaC1saXN0LWNvbnRyb2xsZXIuanMiXSwibmFtZXMiOlsiTWVudSIsIk1lbnVJdGVtIiwicmVtb3RlIiwiU3RhdGVQcm9wVHlwZSIsIlByb3BUeXBlcyIsIm9uZU9mIiwiQmFyZUlzc3VlaXNoTGlzdENvbnRyb2xsZXIiLCJSZWFjdCIsIkNvbXBvbmVudCIsImNvbnN0cnVjdG9yIiwicHJvcHMiLCJ1cmwiLCJzaGVsbCIsIm9wZW5FeHRlcm5hbCIsInBhY2thZ2UiLCJjb21wb25lbnQiLCJuYW1lIiwiaXNzdWVpc2giLCJtZW51IiwiYXBwZW5kIiwibGFiZWwiLCJjbGljayIsIm9uT3BlblJldmlld3MiLCJvcGVuT25HaXRIdWIiLCJnZXRHaXRIdWJVUkwiLCJwb3B1cCIsImdldEN1cnJlbnRXaW5kb3ciLCJzdGF0ZSIsImdldERlcml2ZWRTdGF0ZUZyb21Qcm9wcyIsInJlc3VsdHMiLCJsYXN0UmVzdWx0cyIsImlzc3VlaXNoZXMiLCJtYXAiLCJub2RlIiwiSXNzdWVpc2giLCJmaWx0ZXIiLCJyZXN1bHRGaWx0ZXIiLCJyZW5kZXIiLCJ0aXRsZSIsImlzTG9hZGluZyIsInRvdGFsIiwiZXJyb3IiLCJuZWVkUmV2aWV3c0J1dHRvbiIsIm9uT3Blbklzc3VlaXNoIiwib25PcGVuTW9yZSIsInNob3dBY3Rpb25zTWVudSIsImVtcHR5Q29tcG9uZW50IiwiYXJyYXlPZiIsInNoYXBlIiwibnVtYmVyIiwiaXNSZXF1aXJlZCIsInN0cmluZyIsImF1dGhvciIsImxvZ2luIiwiYXZhdGFyVXJsIiwiY3JlYXRlZEF0IiwiaGVhZFJlZk5hbWUiLCJyZXBvc2l0b3J5IiwiaWQiLCJvd25lciIsImNvbW1pdHMiLCJub2RlcyIsImNvbW1pdCIsInN0YXR1cyIsImNvbnRleHRzIiwiYm9vbCIsIm9iamVjdCIsImZ1bmMiLCJlbmRwb2ludCIsIkVuZHBvaW50UHJvcFR5cGUiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFBQTs7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QkFBVStELElBNUNUO0FBNkNqQkMsRUFBQUEsUUFBUSxFQUFFQyw0QkE3Q087QUE4Q2pCM0IsRUFBQUEsaUJBQWlCLEVBQUV0QyxtQkFBVTZEO0FBOUNaLEM7O2dCQURSM0QsMEIsa0JBa0RXO0FBQ3BCdUIsRUFBQUEsT0FBTyxFQUFFLEVBRFc7QUFFcEJXLEVBQUFBLEtBQUssRUFBRSxDQUZhO0FBR3BCSixFQUFBQSxZQUFZLEVBQUUsTUFBTTtBQUhBLEM7O2VBdUVULHlDQUF3QjlCLDBCQUF4QixFQUFvRDtBQUNqRXVCLEVBQUFBLE9BQU87QUFBQTs7QUFBQTtBQUFBO0FBQUE7O0FBQUE7QUFBQTtBQUQwRCxDQUFwRCxDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFJlYWN0IGZyb20gJ3JlYWN0JztcbmltcG9ydCBQcm9wVHlwZXMgZnJvbSAncHJvcC10eXBlcyc7XG5pbXBvcnQge2dyYXBocWwsIGNyZWF0ZUZyYWdtZW50Q29udGFpbmVyfSBmcm9tICdyZWFjdC1yZWxheSc7XG5pbXBvcnQge0VuZHBvaW50UHJvcFR5cGV9IGZyb20gJy4uL3Byb3AtdHlwZXMnO1xuaW1wb3J0IElzc3VlaXNoTGlzdFZpZXcgZnJvbSAnLi4vdmlld3MvaXNzdWVpc2gtbGlzdC12aWV3JztcbmltcG9ydCBJc3N1ZWlzaCBmcm9tICcuLi9tb2RlbHMvaXNzdWVpc2gnO1xuaW1wb3J0IHtzaGVsbCwgcmVtb3RlfSBmcm9tICdlbGVjdHJvbic7XG5jb25zdCB7TWVudSwgTWVudUl0ZW19ID0gcmVtb3RlO1xuaW1wb3J0IHthZGRFdmVudH0gZnJvbSAnLi4vcmVwb3J0ZXItcHJveHknO1xuXG5jb25zdCBTdGF0ZVByb3BUeXBlID0gUHJvcFR5cGVzLm9uZU9mKFsnRVhQRUNURUQnLCAnUEVORElORycsICdTVUNDRVNTJywgJ0VSUk9SJywgJ0ZBSUxVUkUnXSk7XG5cbmV4cG9ydCBjbGFzcyBCYXJlSXNzdWVpc2hMaXN0Q29udHJvbGxlciBleHRlbmRzIFJlYWN0LkNvbXBvbmVudCB7XG4gIHN0YXRpYyBwcm9wVHlwZXMgPSB7XG4gICAgcmVzdWx0czogUHJvcFR5cGVzLmFycmF5T2YoXG4gICAgICBQcm9wVHlwZXMuc2hhcGUoe1xuICAgICAgICBudW1iZXI6IFByb3BUeXBlcy5udW1iZXIuaXNSZXF1aXJlZCxcbiAgICAgICAgdGl0bGU6IFByb3BUeXBlcy5zdHJpbmcuaXNSZXF1aXJlZCxcbiAgICAgICAgdXJsOiBQcm9wVHlwZXMuc3RyaW5nLmlzUmVxdWlyZWQsXG4gICAgICAgIGF1dGhvcjogUHJvcFR5cGVzLnNoYXBlKHtcbiAgICAgICAgICBsb2dpbjogUHJvcFR5cGVzLnN0cmluZy5pc1JlcXVpcmVkLFxuICAgICAgICAgIGF2YXRhclVybDogUHJvcFR5cGVzLnN0cmluZy5pc1JlcXVpcmVkLFxuICAgICAgICB9KSxcbiAgICAgICAgY3JlYXRlZEF0OiBQcm9wVHlwZXMuc3RyaW5nLmlzUmVxdWlyZWQsXG4gICAgICAgIGhlYWRSZWZOYW1lOiBQcm9wVHlwZXMuc3RyaW5nLmlzUmVxdWlyZWQsXG4gICAgICAgIHJlcG9zaXRvcnk6IFByb3BUeXBlcy5zaGFwZSh7XG4gICAgICAgICAgaWQ6IFByb3BUeXBlcy5zdHJpbmcuaXNSZXF1aXJlZCxcbiAgICAgICAgICBuYW1lOiBQcm9wVHlwZXMuc3RyaW5nLmlzUmVxdWlyZWQsXG4gICAgICAgICAgb3duZXI6IFByb3BUeXBlcy5zaGFwZSh7XG4gICAgICAgICAgICBsb2dpbjogUHJvcFR5cGVzLnN0cmluZy5pc1JlcXVpcmVkLFxuICAgICAgICAgIH0pLmlzUmVxdWlyZWQsXG4gICAgICAgIH0pLmlzUmVxdWlyZWQsXG4gICAgICAgIGNvbW1pdHM6IFByb3BUeXBlcy5zaGFwZSh7XG4gICAgICAgICAgbm9kZXM6IFByb3BUeXBlcy5hcnJheU9mKFByb3BUeXBlcy5zaGFwZSh7XG4gICAgICAgICAgICBjb21taXQ6IFByb3BUeXBlcy5zaGFwZSh7XG4gICAgICAgICAgICAgIHN0YXR1czogUHJvcFR5cGVzLnNoYXBlKHtcbiAgICAgICAgICAgICAgICBjb250ZXh0czogUHJvcFR5cGVzLmFycmF5T2YoXG4gICAgICAgICAgICAgICAgICBQcm9wVHlwZXMuc2hhcGUoe1xuICAgICAgICAgICAgICAgICAgICBzdGF0ZTogU3RhdGVQcm9wVHlwZS5pc1JlcXVpcmVkLFxuICAgICAgICAgICAgICAgICAgfSkuaXNSZXF1aXJlZCxcbiAgICAgICAgICAgICAgICApLmlzUmVxdWlyZWQsXG4gICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgfSksXG4gICAgICAgICAgfSkpLFxuICAgICAgICB9KSxcbiAgICAgIH0pLFxuICAgICksXG4gICAgdG90YWw6IFByb3BUeXBlcy5udW1iZXIuaXNSZXF1aXJlZCxcbiAgICBpc0xvYWRpbmc6IFByb3BUeXBlcy5ib29sLmlzUmVxdWlyZWQsXG4gICAgdGl0bGU6IFByb3BUeXBlcy5zdHJpbmcuaXNSZXF1aXJlZCxcbiAgICBlcnJvcjogUHJvcFR5cGVzLm9iamVjdCxcblxuICAgIHJlc3VsdEZpbHRlcjogUHJvcFR5cGVzLmZ1bmMsXG4gICAgb25PcGVuSXNzdWVpc2g6IFByb3BUeXBlcy5mdW5jLmlzUmVxdWlyZWQsXG4gICAgb25PcGVuUmV2aWV3czogUHJvcFR5cGVzLmZ1bmMuaXNSZXF1aXJlZCxcbiAgICBvbk9wZW5Nb3JlOiBQcm9wVHlwZXMuZnVuYyxcblxuICAgIGVtcHR5Q29tcG9uZW50OiBQcm9wVHlwZXMuZnVuYyxcbiAgICBlbmRwb2ludDogRW5kcG9pbnRQcm9wVHlwZSxcbiAgICBuZWVkUmV2aWV3c0J1dHRvbjogUHJvcFR5cGVzLmJvb2wsXG4gIH07XG5cbiAgc3RhdGljIGRlZmF1bHRQcm9wcyA9IHtcbiAgICByZXN1bHRzOiBbXSxcbiAgICB0b3RhbDogMCxcbiAgICByZXN1bHRGaWx0ZXI6ICgpID0+IHRydWUsXG4gIH1cblxuICBjb25zdHJ1Y3Rvcihwcm9wcykge1xuICAgIHN1cGVyKHByb3BzKTtcblxuICAgIHRoaXMuc3RhdGUgPSB7fTtcbiAgfVxuXG4gIHN0YXRpYyBnZXREZXJpdmVkU3RhdGVGcm9tUHJvcHMocHJvcHMsIHN0YXRlKSB7XG4gICAgaWYgKHByb3BzLnJlc3VsdHMgPT09IG51bGwpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGxhc3RSZXN1bHRzOiBudWxsLFxuICAgICAgICBpc3N1ZWlzaGVzOiBbXSxcbiAgICAgIH07XG4gICAgfVxuXG4gICAgaWYgKHByb3BzLnJlc3VsdHMgIT09IHN0YXRlLmxhc3RSZXN1bHRzKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBsYXN0UmVzdWx0czogcHJvcHMucmVzdWx0cyxcbiAgICAgICAgaXNzdWVpc2hlczogcHJvcHMucmVzdWx0cy5tYXAobm9kZSA9PiBuZXcgSXNzdWVpc2gobm9kZSkpLmZpbHRlcihwcm9wcy5yZXN1bHRGaWx0ZXIpLFxuICAgICAgfTtcbiAgICB9XG5cbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuXG4gIG9wZW5PbkdpdEh1YiA9IGFzeW5jIHVybCA9PiB7XG4gICAgYXdhaXQgc2hlbGwub3BlbkV4dGVybmFsKHVybCk7XG4gICAgYWRkRXZlbnQoJ29wZW4taXNzdWVpc2gtaW4tYnJvd3NlcicsIHtwYWNrYWdlOiAnZ2l0aHViJywgY29tcG9uZW50OiB0aGlzLmNvbnN0cnVjdG9yLm5hbWV9KTtcbiAgfVxuXG4gIHNob3dBY3Rpb25zTWVudSA9IC8qIGlzdGFuYnVsIGlnbm9yZSBuZXh0ICovIGlzc3VlaXNoID0+IHtcbiAgICBjb25zdCBtZW51ID0gbmV3IE1lbnUoKTtcblxuICAgIG1lbnUuYXBwZW5kKG5ldyBNZW51SXRlbSh7XG4gICAgICBsYWJlbDogJ1NlZSByZXZpZXdzJyxcbiAgICAgIGNsaWNrOiAoKSA9PiB0aGlzLnByb3BzLm9uT3BlblJldmlld3MoaXNzdWVpc2gpLFxuICAgIH0pKTtcblxuICAgIG1lbnUuYXBwZW5kKG5ldyBNZW51SXRlbSh7XG4gICAgICBsYWJlbDogJ09wZW4gb24gR2l0SHViJyxcbiAgICAgIGNsaWNrOiAoKSA9PiB0aGlzLm9wZW5PbkdpdEh1Yihpc3N1ZWlzaC5nZXRHaXRIdWJVUkwoKSksXG4gICAgfSkpO1xuXG4gICAgbWVudS5wb3B1cChyZW1vdGUuZ2V0Q3VycmVudFdpbmRvdygpKTtcbiAgfVxuXG4gIHJlbmRlcigpIHtcbiAgICByZXR1cm4gKFxuICAgICAgPElzc3VlaXNoTGlzdFZpZXdcbiAgICAgICAgdGl0bGU9e3RoaXMucHJvcHMudGl0bGV9XG4gICAgICAgIGlzTG9hZGluZz17dGhpcy5wcm9wcy5pc0xvYWRpbmd9XG4gICAgICAgIHRvdGFsPXt0aGlzLnByb3BzLnRvdGFsfVxuICAgICAgICBpc3N1ZWlzaGVzPXt0aGlzLnN0YXRlLmlzc3VlaXNoZXN9XG4gICAgICAgIGVycm9yPXt0aGlzLnByb3BzLmVycm9yfVxuICAgICAgICBuZWVkUmV2aWV3c0J1dHRvbj17dGhpcy5wcm9wcy5uZWVkUmV2aWV3c0J1dHRvbn1cbiAgICAgICAgb25Jc3N1ZWlzaENsaWNrPXt0aGlzLnByb3BzLm9uT3Blbklzc3VlaXNofVxuICAgICAgICBvbk1vcmVDbGljaz17dGhpcy5wcm9wcy5vbk9wZW5Nb3JlfVxuICAgICAgICBvcGVuUmV2aWV3cz17dGhpcy5wcm9wcy5vbk9wZW5SZXZpZXdzfVxuICAgICAgICBvcGVuT25HaXRIdWI9e3RoaXMub3Blbk9uR2l0SHVifVxuICAgICAgICBzaG93QWN0aW9uc01lbnU9e3RoaXMuc2hvd0FjdGlvbnNNZW51fVxuICAgICAgICBlbXB0eUNvbXBvbmVudD17dGhpcy5wcm9wcy5lbXB0eUNvbXBvbmVudH1cbiAgICAgIC8+XG4gICAgKTtcbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBjcmVhdGVGcmFnbWVudENvbnRhaW5lcihCYXJlSXNzdWVpc2hMaXN0Q29udHJvbGxlciwge1xuICByZXN1bHRzOiBncmFwaHFsYFxuICAgIGZyYWdtZW50IGlzc3VlaXNoTGlzdENvbnRyb2xsZXJfcmVzdWx0cyBvbiBQdWxsUmVxdWVzdFxuICAgIEByZWxheShwbHVyYWw6IHRydWUpXG4gICAgQGFyZ3VtZW50RGVmaW5pdGlvbnMoXG4gICAgICBjaGVja1N1aXRlQ291bnQ6IHt0eXBlOiBcIkludCFcIn1cbiAgICAgIGNoZWNrU3VpdGVDdXJzb3I6IHt0eXBlOiBcIlN0cmluZ1wifVxuICAgICAgY2hlY2tSdW5Db3VudDoge3R5cGU6IFwiSW50IVwifVxuICAgICAgY2hlY2tSdW5DdXJzb3I6IHt0eXBlOiBcIlN0cmluZ1wifVxuICAgICkge1xuICAgICAgbnVtYmVyXG4gICAgICB0aXRsZVxuICAgICAgdXJsXG4gICAgICBhdXRob3Ige1xuICAgICAgICBsb2dpblxuICAgICAgICBhdmF0YXJVcmxcbiAgICAgIH1cbiAgICAgIGNyZWF0ZWRBdFxuICAgICAgaGVhZFJlZk5hbWVcblxuICAgICAgcmVwb3NpdG9yeSB7XG4gICAgICAgIGlkXG4gICAgICAgIG5hbWVcbiAgICAgICAgb3duZXIge1xuICAgICAgICAgIGxvZ2luXG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgY29tbWl0cyhsYXN0OjEpIHtcbiAgICAgICAgbm9kZXMge1xuICAgICAgICAgIGNvbW1pdCB7XG4gICAgICAgICAgICBzdGF0dXMge1xuICAgICAgICAgICAgICBjb250ZXh0cyB7XG4gICAgICAgICAgICAgICAgaWRcbiAgICAgICAgICAgICAgICBzdGF0ZVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC4uLmNoZWNrU3VpdGVzQWNjdW11bGF0b3JfY29tbWl0IEBhcmd1bWVudHMoXG4gICAgICAgICAgICAgIGNoZWNrU3VpdGVDb3VudDogJGNoZWNrU3VpdGVDb3VudFxuICAgICAgICAgICAgICBjaGVja1N1aXRlQ3Vyc29yOiAkY2hlY2tTdWl0ZUN1cnNvclxuICAgICAgICAgICAgICBjaGVja1J1bkNvdW50OiAkY2hlY2tSdW5Db3VudFxuICAgICAgICAgICAgICBjaGVja1J1bkN1cnNvcjogJGNoZWNrUnVuQ3Vyc29yXG4gICAgICAgICAgICApXG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICBgLFxufSk7XG4iXX0=